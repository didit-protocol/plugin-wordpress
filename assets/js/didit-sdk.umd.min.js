/**
 * Didit SDK for Web v0.1.5
 * (c) 2026 Didit
 * @license MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).DiditSDK={})}(this,function(e){"use strict";const t=9999,n=!0,i=!0,a=!1,s="didit-modal-overlay",o="didit-modal-container",d="didit-verification-iframe",r="didit-close-button",l="didit-loading",c="didit-confirm-overlay",h="didit-confirm-box",m="didit-embedded";class u{static get isEnabled(){return this._enabled}static set isEnabled(e){this._enabled=e}static log(...e){this._enabled&&console.log("[DiditSDK]",...e)}static warn(...e){this._enabled&&console.warn("[DiditSDK]",...e)}static error(...e){this._enabled&&console.error("[DiditSDK]",...e)}}function f(e,t){return{type:e,message:t||{sessionExpired:"Your verification session has expired.",networkError:"A network error occurred. Please try again.",cameraAccessDenied:"Camera access is required for verification.",unknown:t||"An unknown error occurred."}[e]}}u._enabled=!1;class p{constructor(e,a){this.state={isOpen:!1,isLoading:!0,showConfirmation:!1},this.overlay=null,this.container=null,this.iframe=null,this.loadingEl=null,this.confirmOverlay=null,this.boundHandleMessage=null,this.boundHandleKeydown=null,this.embedded=!1,this.embeddedContainer=null,this.modalId=`didit-modal-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,this.config={zIndex:e?.zIndex??t,showCloseButton:e?.showCloseButton??n,showExitConfirmation:e?.showExitConfirmation??i},this.callbacks=a,this.containerElement=e?.containerElement??document.body,this.embedded=e?.embedded??!1,this.embedded&&e?.embeddedContainerId&&(this.embeddedContainer=document.getElementById(e.embeddedContainerId))}injectStyles(){const e="didit-sdk-styles";if(document.getElementById(e))return;const t=document.createElement("style");t.id=e,t.textContent=`\n      .${s} {\n        display: none;\n        position: fixed;\n        inset: 0;\n        background: rgba(0, 0, 0, 0.6);\n        z-index: ${this.config.zIndex};\n        justify-content: center;\n        align-items: center;\n        padding: 1rem;\n        opacity: 0;\n        transition: opacity 0.2s ease-out;\n      }\n\n      .${s}.active {\n        display: flex;\n        opacity: 1;\n      }\n\n      .${o} {\n        position: relative;\n        width: 100%;\n        max-width: 500px;\n        max-height: 90vh;\n        border-radius: 16px;\n        overflow: hidden;\n        background: transparent;\n      }\n\n      .${s}.active .${o} {\n        transform: scale(1);\n      }\n\n      .${d} {\n        width: 100%;\n        height: 700px;\n        border: none;\n        display: block;\n      }\n\n      .${r} {\n        position: absolute;\n        top: 4px;\n        right: 4px;\n        width: 24px;\n        height: 24px;\n        background: transparent;\n        border: none;\n        cursor: pointer;\n        padding: 0;\n        z-index: 10;\n        outline: none;\n      }\n\n      .${r}:hover,\n      .${r}:focus {\n        background: transparent;\n        opacity: 0.5;\n      }\n\n      .${r} svg {\n        stroke: #666;\n        stroke-width: 2;\n        stroke-linecap: round;\n      }\n\n      .${l} {\n        position: absolute;\n        inset: 0;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        background: #fafafa;\n        z-index: 5;\n      }\n\n      .${l}.hidden {\n        display: none;\n      }\n\n      .${l} svg {\n        width: 48px;\n        height: 48px;\n        animation: didit-spin 1s linear infinite;\n      }\n\n      .${l} circle {\n        stroke: #e5e5e5;\n        stroke-width: 3;\n        fill: none;\n      }\n\n      .${l} path {\n        stroke: #525252;\n        stroke-width: 3;\n        stroke-linecap: round;\n        fill: none;\n      }\n\n      @keyframes didit-spin {\n        from { transform: rotate(0deg); }\n        to { transform: rotate(360deg); }\n      }\n\n      .${c} {\n        display: none;\n        position: absolute;\n        inset: 0;\n        background: rgba(0, 0, 0, 0.5);\n        z-index: 20;\n        justify-content: center;\n        align-items: center;\n        opacity: 0;\n        transition: opacity 0.15s ease-out;\n      }\n\n      .${c}.active {\n        display: flex;\n        opacity: 1;\n      }\n\n      .${h} {\n        background: #fff;\n        border-radius: 12px;\n        padding: 1.5rem;\n        text-align: center;\n        max-width: 300px;\n        margin: 1rem;\n        transform: scale(0.95);\n        transition: transform 0.15s ease-out;\n        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);\n      }\n\n      .${c}.active .${h} {\n        transform: scale(1);\n      }\n\n      .${h} h3 {\n        color: #1a1a2e;\n        margin: 0 0 0.5rem 0;\n        font-size: 1.125rem;\n        font-weight: 600;\n      }\n\n      .${h} p {\n        color: #666;\n        font-size: 0.875rem;\n        margin: 0 0 1.25rem 0;\n        line-height: 1.5;\n      }\n\n      .didit-confirm-actions {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        gap: 1rem;\n      }\n\n      .didit-confirm-actions button {\n        background: #2563eb;\n        color: #fff;\n        border: none;\n        padding: 0.625rem 1.25rem;\n        border-radius: 8px;\n        font-size: 0.875rem;\n        font-weight: 500;\n        cursor: pointer;\n        transition: background 0.15s ease;\n      }\n\n      .didit-confirm-actions button:hover {\n        background: #1d4ed8;\n      }\n\n      .didit-confirm-actions span {\n        color: #666;\n        font-size: 0.875rem;\n        cursor: pointer;\n        padding: 0.625rem;\n        transition: color 0.15s ease;\n      }\n\n      .didit-confirm-actions span:hover {\n        color: #1a1a2e;\n      }\n\n      @media (max-width: 540px) {\n        .${s} {\n          padding: 0;\n        }\n\n        .${o} {\n          max-width: 100%;\n          max-height: 100vh;\n          border-radius: 0;\n        }\n\n        .${d} {\n          height: 100vh;\n        }\n      }\n\n      .${m} {\n        position: relative;\n        width: 100%;\n        height: 100%;\n      }\n\n      .${m} .${d} {\n        width: 100%;\n        height: 100%;\n      }\n\n      .${m} .${l} {\n        border-radius: 0;\n      }\n    `,document.head.appendChild(t)}createDOM(){if(this.injectStyles(),this.embedded&&this.embeddedContainer)this.createEmbeddedDOM();else{if(this.overlay=document.createElement("div"),this.overlay.id=this.modalId,this.overlay.className=s,this.overlay.setAttribute("role","dialog"),this.overlay.setAttribute("aria-modal","true"),this.overlay.setAttribute("aria-label","Didit Verification"),this.container=document.createElement("div"),this.container.className=o,this.loadingEl=document.createElement("div"),this.loadingEl.className=l,this.loadingEl.innerHTML='\n      <svg viewBox="0 0 24 24">\n        <circle cx="12" cy="12" r="10" />\n        <path d="M12 2a10 10 0 0 1 10 10" />\n      </svg>\n    ',this.config.showCloseButton){const e=document.createElement("button");e.className=r,e.setAttribute("aria-label","Close verification"),e.innerHTML='\n        <svg width="14" height="14" viewBox="0 0 14 14">\n          <line x1="1" y1="1" x2="13" y2="13" />\n          <line x1="13" y1="1" x2="1" y2="13" />\n        </svg>\n      ',e.addEventListener("click",()=>this.handleCloseRequest()),this.container.appendChild(e)}this.iframe=document.createElement("iframe"),this.iframe.className=d,this.iframe.setAttribute("allow","camera; microphone; fullscreen; autoplay; encrypted-media; geolocation"),this.iframe.setAttribute("title","Didit Verification"),this.iframe.addEventListener("load",()=>this.handleIframeLoad()),this.confirmOverlay=document.createElement("div"),this.confirmOverlay.className=c,this.confirmOverlay.innerHTML=`\n      <div class="${h}">\n        <h3>Exit verification?</h3>\n        <p>Exiting will end your verification process. Are you sure?</p>\n        <div class="didit-confirm-actions">\n          <button type="button" data-action="continue">Continue</button>\n          <span data-action="exit">Exit</span>\n        </div>\n      </div>\n    `,this.confirmOverlay.querySelector('[data-action="continue"]')?.addEventListener("click",()=>{this.hideConfirmation()}),this.confirmOverlay.querySelector('[data-action="exit"]')?.addEventListener("click",()=>{this.confirmExit()}),this.container.appendChild(this.loadingEl),this.container.appendChild(this.iframe),this.container.appendChild(this.confirmOverlay),this.overlay.appendChild(this.container),this.overlay.addEventListener("click",e=>{e.target===this.overlay&&this.handleCloseRequest()}),this.containerElement.appendChild(this.overlay)}}createEmbeddedDOM(){this.embeddedContainer&&(this.container=document.createElement("div"),this.container.id=this.modalId,this.container.className=m,this.loadingEl=document.createElement("div"),this.loadingEl.className=l,this.loadingEl.innerHTML='\n      <svg viewBox="0 0 24 24">\n        <circle cx="12" cy="12" r="10" />\n        <path d="M12 2a10 10 0 0 1 10 10" />\n      </svg>\n    ',this.iframe=document.createElement("iframe"),this.iframe.className=d,this.iframe.setAttribute("allow","camera; microphone; fullscreen; autoplay; encrypted-media; geolocation"),this.iframe.setAttribute("title","Didit Verification"),this.iframe.addEventListener("load",()=>this.handleIframeLoad()),this.container.appendChild(this.loadingEl),this.container.appendChild(this.iframe),this.embeddedContainer.appendChild(this.container))}setupEventListeners(){this.boundHandleMessage=this.handleMessage.bind(this),window.addEventListener("message",this.boundHandleMessage),this.boundHandleKeydown=this.handleKeydown.bind(this),document.addEventListener("keydown",this.boundHandleKeydown)}removeEventListeners(){this.boundHandleMessage&&(window.removeEventListener("message",this.boundHandleMessage),this.boundHandleMessage=null),this.boundHandleKeydown&&(document.removeEventListener("keydown",this.boundHandleKeydown),this.boundHandleKeydown=null)}handleMessage(e){if(!function(e){try{return new URL(e).hostname.endsWith(".didit.me")}catch{return!1}}(e.origin))return;let t;u.log("Received postMessage:",e.data);try{t="string"==typeof e.data?JSON.parse(e.data):e.data}catch{return void u.warn("Failed to parse postMessage:",e.data)}"didit:close_request"!==t.type?this.callbacks.onMessage(t):this.handleCloseRequest()}handleKeydown(e){this.state.isOpen&&"Escape"===e.key&&(e.preventDefault(),this.state.showConfirmation?this.hideConfirmation():this.handleCloseRequest())}handleIframeLoad(){this.iframe?.src&&"about:blank"!==this.iframe.src&&(this.state.isLoading=!1,this.loadingEl?.classList.add("hidden"),this.callbacks.onIframeLoad())}handleCloseRequest(){this.config.showExitConfirmation?this.showConfirmation():this.callbacks.onCloseConfirmed()}showConfirmation(){this.state.showConfirmation=!0,this.confirmOverlay?.classList.add("active"),this.callbacks.onClose()}hideConfirmation(){this.state.showConfirmation=!1,this.confirmOverlay?.classList.remove("active")}confirmExit(){this.hideConfirmation(),this.callbacks.onCloseConfirmed()}open(e){this.overlay||this.container||(this.createDOM(),this.setupEventListeners()),u.log("Opening with URL:",e),this.state.isLoading=!0,this.state.showConfirmation=!1,this.loadingEl?.classList.remove("hidden"),this.confirmOverlay?.classList.remove("active"),this.iframe&&(this.iframe.src=e),this.state.isOpen=!0,this.embedded||(this.overlay?.classList.add("active"),document.body.style.overflow="hidden")}close(){u.log("Closing"),this.state.isOpen=!1,this.state.isLoading=!0,this.state.showConfirmation=!1,this.iframe&&(this.iframe.src="about:blank"),this.embedded||(this.overlay?.classList.remove("active"),document.body.style.overflow="")}destroy(){u.log("Destroying"),this.close(),this.removeEventListeners(),this.embedded&&this.container&&this.container.parentNode?this.container.parentNode.removeChild(this.container):this.overlay&&this.overlay.parentNode&&this.overlay.parentNode.removeChild(this.overlay),this.overlay=null,this.container=null,this.iframe=null,this.loadingEl=null,this.confirmOverlay=null}isOpen(){return this.state.isOpen}isLoading(){return this.state.isLoading}}class g{static get shared(){return g._instance||(g._instance=new g),g._instance}static reset(){g._instance&&(g._instance.destroy(),g._instance=null)}get state(){return this._state}get configuration(){return this._configuration}get isPresented(){return this._modal?.isOpen()??!1}get errorMessage(){return this._errorMessage}constructor(){this._state="idle",this._modal=null,u.log("DiditSdk initialized")}async startVerification(e){const t=e.configuration;this._configuration=t,u.isEnabled=t?.loggingEnabled??a,u.log("Starting verification with options:",e),this._modal&&(this._modal.destroy(),this._modal=null),this._modal=new p(t,{onClose:()=>this.handleModalClose(),onCloseConfirmed:()=>this.handleModalCloseConfirmed(),onMessage:e=>this.handleVerificationEvent(e),onIframeLoad:()=>this.handleIframeLoad()});try{const{url:t}=e;if(!t||"string"!=typeof t)throw new Error("Invalid options: url is required");this._url=t,this.setState("loading"),this.emitInternalEvent("didit:started",{}),this._modal?.open(this._url)}catch(e){this.handleError(e)}}close(){u.log("Closing verification programmatically"),this.handleModalCloseConfirmed()}destroy(){u.log("Destroying SDK instance"),this._modal?.destroy(),this._modal=null,this.reset()}handleModalClose(){u.log("Modal close requested")}handleModalCloseConfirmed(){u.log("Modal close confirmed");const e=this.buildSessionData();this._modal?.close(),this.reset();const t={type:"cancelled",session:e};this.onComplete?.(t)}handleIframeLoad(){u.log("Iframe loaded")}emitInternalEvent(e,t){const n={type:e,data:t,timestamp:Date.now()};u.log("Emitting internal event:",n),this.onEvent?.(n)}handleVerificationEvent(e){switch(u.log("Verification event:",e),this.onEvent?.(e),e.type){case"didit:ready":u.log("Verification iframe ready");break;case"didit:started":u.log("User started verification");break;case"didit:step_started":u.log("Step started:",e.data?.step);break;case"didit:step_completed":u.log("Step completed:",e.data?.step,"-> next:",e.data?.nextStep);break;case"didit:media_started":u.log("Media started:",e.data?.mediaType,"for step:",e.data?.step);break;case"didit:media_captured":u.log("Media captured for step:",e.data?.step,"isAuto:",e.data?.isAuto);break;case"didit:document_selected":u.log("Document selected:",e.data?.documentType,"country:",e.data?.country);break;case"didit:verification_submitted":u.log("Verification submitted for step:",e.data?.step);break;case"didit:code_sent":u.log("Code sent via:",e.data?.channel,"codeSize:",e.data?.codeSize);break;case"didit:code_verified":u.log("Code verified via:",e.data?.channel);break;case"didit:status_updated":u.log("Status updated:",e.data?.status,"step:",e.data?.step);break;case"didit:completed":this.handleVerificationCompleted(e);break;case"didit:cancelled":this.handleVerificationCancelled(e);break;case"didit:error":this.handleVerificationError(e);break;case"didit:step_changed":u.log("Step changed:",e.data?.step)}}handleVerificationCompleted(e){u.log("Verification completed:",e.data);const t=this.buildSessionData(e.data);this._configuration?.closeModalOnComplete&&(this._modal?.close(),this.reset());const n={type:"completed",session:t};this.onComplete?.(n)}handleVerificationCancelled(e){u.log("Verification cancelled:",e.data);const t=this.buildSessionData(e.data);this._modal?.close(),this.reset();const n={type:"cancelled",session:t};this.onComplete?.(n)}handleVerificationError(e){u.log("Verification error:",e.data)}handleError(e){let t;u.error("SDK error:",e),t=e instanceof Error?f("unknown",e.message):f("unknown","An unknown error occurred"),this._errorMessage=t.message,this.setState("error"),this._modal?.close(),this.reset();const n={type:"failed",error:t};this.onComplete?.(n)}setState(e){const t=this._state;this._state=e,t!==e&&(u.log("State changed:",t,"->",e),this.onStateChange?.(e,this._errorMessage))}reset(){this._state="idle",this._sessionId=void 0,this._url=void 0,this._errorMessage=void 0,this._configuration=void 0}buildSessionData(e){const t=e?.sessionId||this._sessionId;if(t)return{sessionId:t,status:e?.status||"Pending"}}}g._instance=null,e.DiditSdk=g,e.SDK_VERSION="0.1.4",e.default=g,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=didit-sdk.umd.min.js.map
